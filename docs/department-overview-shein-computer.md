# تقرير تفصيلي عن قسمي «شي إن» و«الكمبيوتر» في نظام مارب

## 1. بنية التقسيم والضبط العام
- تُحدد الأقسام المدعومة في إعدادات العربة مع ربط كل قسم بجذر التصنيفات والمعرّفات المستخدمة داخل الواجهات، مما يسمح بتوجيه المنتجات والطلبات تلقائيًا إلى القسم الصحيح حتى عند اختلاف الواجهات أو مصادر البيانات.【F:config/cart.php†L3-L31】
- تعتمد خدمات الإحصاءات والأتمتة على ثوابت الأقسام داخل `DepartmentReportService` التي توفر كذلك آلية لتجميع جميع الفئات الفرعية تحت جذر القسم عند بناء تقارير الأداء.【F:app/Services/DepartmentReportService.php†L14-L159】
- تُضبط سياسات العربون لكل قسم عبر إعدادات `config/orders.php`، وبذلك يحصل «شي إن» و«الكمبيوتر» على نسب وديعة وحدود أدنى مستقلة يمكن تعديلها من لوحة التحكم أو عبر ملف البيئة.【F:config/orders.php†L3-L23】

## 2. نماذج البيانات وقاعدة البيانات
- يحتفظ قسم «شي إن» بجدول `shein_order_batches` المخصص لتجميع الطلبات في دفعات، مع ربط اختياري لكل طلب عبر المفتاح الأجنبي `shein_batch_id`، ما يدعم المتابعة المالية وسير العمل الجماعي للطلبات.【F:database/migrations/2026_01_15_000000_create_shein_order_batches_table.php†L12-L49】
- تم توسيع جدول الطلبات الخاصة (`request_device`) بحقل `section` الافتراضي على «الكمبيوتر» لتمييز طلبات الأجهزة، ما يسمح بإعادة استخدام نفس الواجهة لطلبات «شي إن» مع تغيير القسم.【F:database/migrations/2025_04_06_232444_add_section_to_request_device_table.php†L12-L40】
- توفر Seeder مخصصة بيانات تجريبية لطلبات أجهزة الكمبيوتر لضمان جاهزية الشاشة عند بدء التشغيل، ويمكن تعديلها لإدخال بيانات «شي إن» بنفس البنية.【F:database/seeders/RequestDeviceSeeder.php†L16-L73】

## 3. واجهة إدارة قسم «شي إن»
- يدقق `ItemController::shein` في صلاحيات المنتجات والطلبات قبل إظهار لوحة القسم، ثم يسترجع بيانات المعلن المخصصة لتغذية البطاقة الأولى في الشاشة الرئيسية.【F:app/Http/Controllers/ItemController.php†L92-L103】
- تعرض واجهة `items/shein/index.blade.php` بطاقات سريعة للإعدادات، سياسات التسعير، نشر إعلان جديد، إدارة المنتجات، الطلبات، الطلبات الخاصة، فرق المندوبين، التقارير، والدعم؛ وتُحرس كل بطاقة بصلاحيات دقيقة للتأكد من التزام الفريق بالنطاق المحدد.【F:resources/views/items/shein/index.blade.php†L61-L239】
- تغطي مسارات القسم جميع وظائفه من خلال مجموعة `item.shein.*`، بما في ذلك CRUD للمنتجات، إدارة الدُفعات (`batches`)، تقارير القسم، وشاشة الدعم المفلترة بحسب القسم.【F:routes/web.php†L458-L519】
- توفر خدمات مثل `SheinOrderBatchService` عمليات إنشاء الدُفعات وتعيين الطلبات وتحديثها جماعيًا، بما في ذلك تسجيل الملاحظات والتاريخ وتحديث حالة الطلب مع إمكانية إخطار العميل، ما يجعل إدارة الحملات الضخمة أكثر كفاءة.【F:app/Services/SheinOrderBatchService.php†L13-L152】
- يخصص `SheinRequestController` واجهة طلبات خاصة بالقسم، مستندًا إلى المتحكم الأساسي `SectionedRequestDeviceController` الذي يبني الاستعلامات والإحصاءات والواجهات بناءً على قيمة القسم.【F:app/Http/Controllers/SheinRequestController.php†L5-L18】【F:app/Http/Controllers/SectionedRequestDeviceController.php†L16-L124】

## 4. واجهة إدارة قسم «الكمبيوتر»
- يوجّه `ItemController::computer` (والمسارات التابعة له) المستخدمين إلى لوحة إدارة الكمبيوتر التي تعتمد نفس بطاقات «شي إن» لكن بصلاحيات `computer-*` وتدعم نشر الإعلانات وإدارة المنتجات من خلال واجهات متخصصة.【F:app/Http/Controllers/ItemController.php†L45-L87】【F:resources/views/items/computer/index.blade.php†L63-L243】
- تُعرّف مجموعة المسارات `item.computer.*` طرق الإعدادات، نشر الإعلانات، الطلبات الخاصة، إدارة المندوبين، ربط بيانات المعلن، وإظهار التقارير والدعم مع تمرير معرّف القسم إلى الخدمات المشتركة.【F:routes/web.php†L531-L576】
- يضبط `RequestDeviceController` القسم إلى «الكمبيوتر» مع تعيين صلاحيات وعناوين العرض المناسبة، مما يمكّن الفرق من إدارة الطلبات الخاصة بالأجهزة عبر نفس البنية التي تخدم «شي إن».【F:app/Http/Controllers/RequestDeviceController.php†L5-L20】
- تتولى Seeder الصلاحيات `ComputerManagementPermissionSeeder` إنشاء صلاحيات `computer-ads` و`computer-requests` مع مشتقاتها تلقائيًا، ما يضمن جاهزية التحكم بالوصول دون تدخل يدوي.【F:database/seeders/ComputerManagementPermissionSeeder.php†L15-L73】

## 5. الخدمات والسياسات المشتركة
- توفر `DepartmentAdvertiserService` آلية قراءة وكتابة بيانات المعلن لكل قسم، مع دعم رفع الصور وتخزينها في الإعدادات، بالإضافة إلى اكتشاف القسم من خلال نوع الواجهة أو تسلسل التصنيفات لضمان اتساق الهوية البصرية في جميع الشاشات.【F:app/Services/DepartmentAdvertiserService.php†L15-L218】
- يجمع `DepartmentPolicyService` إعدادات الوديعة وسياسة الاسترجاع ورقم الواتساب لكل قسم، مع بناء سياسة موحدة تُستخدم في الواجهات والخدمات، ويرجع إلى القيم الافتراضية عند غياب التخصيصات.【F:app/Services/DepartmentPolicyService.php†L9-L206】
- تنفذ شاشة إعدادات الأقسام نموذجًا موحدًا يسمح بتعديل نسب العربون، الحد الأدنى، قنوات الواتساب، وسياسة الاسترجاع مع التحقق من صحة المدخلات واسترجاع قيم الإعدادات تلقائيًا.【F:resources/views/items/department-settings.blade.php†L1-L162】
- يعتمد ضبط الإعدادات الخلفية على `SettingController` الذي يتحقق من صحة الحقول الخاصة بكل قسم ويطبّق معالجات إضافية مثل تحويل نسب العربون من نسبة مئوية إلى قيمة عشرية ومزامنة سياسات الاسترجاع.【F:app/Http/Controllers/SettingController.php†L80-L218】
- تُنظم سياسات التوصيل من خلال `DeliveryPriceController` التي تفرض التحقق من حدود الشحن، أوضاع التسعير، خيارات الدفع، وربط السياسة بالقسم المناسب لضمان سلامة البيانات قبل تفعيلها.【F:app/Http/Controllers/DeliveryPriceController.php†L162-L255】
- يستخدم `OrderController` خدمة التقارير لاسترجاع التصنيفات الخاصة بالقسم عند عرض الطلبات، ويُطبق فلاتر حسب القسم وصلاحيات الوصول لتأمين تجربة متابعة متخصصة لكل فريق.【F:app/Http/Controllers/OrderController.php†L46-L200】
- يوفّر `CartController` خريطة تحويل أسماء الأقسام (بالعربية والإنجليزية) لضمان توجيه الطلبات والروابط إلى القسم الصحيح حتى عند تعدد صيغ الكتابة أو البحث، ما يحافظ على تجربة متسقة للمستخدم النهائي.【F:app/Http/Controllers/CartController.php†L1093-L1159】
- تعمل مهمة `OrdersSettlementReminder` المجدولة على إرسال التذكيرات وإلغاء الطلبات المتأخرة لأقسام «شي إن» و«الكمبيوتر»، مستندة إلى إعدادات زمنية مستقلة لكل قسم لضمان التزام العملاء بمواعيد الدفع.【F:app/Console/Commands/OrdersSettlementReminder.php†L17-L194】

## 6. التقارير والدعم
- تجمع `DepartmentReportService` مؤشرات الأداء الخاصة بكل قسم (إجمالي الطلبات، المبيعات، العملاء المميزون، حالات الدفع، التذاكر المفتوحة) مع إمكانية الحصول على ملخص سريع يستخدم في واجهات التقارير ولوحات المتابعة.【F:app/Services/DepartmentReportService.php†L34-L135】
- ترتبط بطاقات الدعم في كل لوحة بمراقب المحادثات (`ChatMonitorController`) مع تمرير معرّف القسم داخل المسار، مما يسمح بتصفية المحادثات والبلاغات وتشغيل فرق الدعم المتخصصة دون تداخل بين الأقسام.【F:routes/web.php†L510-L517】【F:routes/web.php†L568-L573】

## 7. سير العمل التشغيلي المقترح
1. **تهيئة الإعدادات الأساسية:** تحديث بيانات المعلن وسياسات العربون والواتساب وسياسة الاسترجاع لكل قسم من شاشة الإعدادات قبل فتح الواجهات للفرق الميدانية.【F:resources/views/items/department-settings.blade.php†L61-L162】
2. **إدارة الكتالوج والإعلانات:** استخدام بطاقات «نشر إعلان جديد» و«إدارة المنتجات» المتاحة في كل لوحة، مع ضمان أن التحويلات البرمجية في `ItemController` توجه المستخدم إلى القسم الصحيح بناءً على الصلاحيات أو معرّف الجذر.【F:resources/views/items/shein/index.blade.php†L100-L138】【F:resources/views/items/computer/index.blade.php†L104-L142】【F:app/Http/Controllers/ItemController.php†L45-L195】
3. **متابعة الطلبات والدفعات:** مراقبة الطلبات من الشاشات المتخصصة، واستخدام دُفعات «شي إن» عند الحاجة لمعالجة جماعية، مستفيدين من الخدمات التي تضمن تحديث الحالة وتسجيل التاريخ تلقائيًا.【F:app/Http/Controllers/OrderController.php†L121-L200】【F:app/Services/SheinOrderBatchService.php†L34-L143】
4. **إدارة الطلبات الخاصة:** معالجة طلبات الأجهزة أو الطلبات الخاصة بـ«شي إن» عبر المتحكمات الفرعية التي تعيد استخدام استعلامات `SectionedRequestDeviceController` وتعرض إحصاءات يومية وأسبوعية للفريق التشغيلي.【F:app/Http/Controllers/SectionedRequestDeviceController.php†L26-L114】【F:app/Http/Controllers/SheinRequestController.php†L5-L18】【F:app/Http/Controllers/RequestDeviceController.php†L5-L20】
5. **تنسيق فرق المندوبين واللوجستيات:** تحديث سياسات التوصيل من خلال الشاشة المشتركة ثم توزيع المهام على المندوبين من لوحات كل قسم، مع الاستفادة من الصلاحيات المحمية لضمان عدم تعارض المهام بين الفرق.【F:resources/views/items/shein/index.blade.php†L80-L198】【F:resources/views/items/computer/index.blade.php†L84-L200】【F:app/Http/Controllers/DeliveryPriceController.php†L162-L255】
6. **تحليل الأداء والدعم:** الاستفادة من تقارير الأقسام ومراقبة المحادثات لتجميع مؤشرات الأداء، وضبط إعدادات التذكير التلقائي للدفع لضمان إغلاق الطلبات أو تحصيلها في الوقت المحدد.【F:routes/web.php†L510-L519】【F:routes/web.php†L568-L573】【F:app/Console/Commands/OrdersSettlementReminder.php†L69-L190】

## 8. خلاصة
تؤمن البنية الحالية فصلًا واضحًا بين قسمي «شي إن» و«الكمبيوتر» مع توفير خدمات مشتركة تضبط الهوية والسياسات واللوجستيات لكل قسم على حدة. تكامل المسارات، المتحكمات، الخدمات، وجداول البيانات يتيح للفرق التشغيلية العمل بانسجام، مع ضمان أن التقارير والدعم والأتمتة تغطي دورة حياة الطلب كاملة من نشر الإعلان وحتى الإغلاق المالي.【F:routes/web.php†L458-L576】【F:app/Services/DepartmentAdvertiserService.php†L15-L218】【F:app/Services/DepartmentReportService.php†L34-L188】